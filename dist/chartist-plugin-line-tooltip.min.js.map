{"version":3,"file":"chartist-plugin-line-tooltip.min.js","sources":["chartist-plugin-line-tooltip.js"],"names":["root","factory","define","amd","returnExportsGlobal","exports","module","this","window","document","Chartist","defaultOptions","formatHeader","noop","formatValue","cursor","hiddenPosition","header","classNames","tooltip","Tooltip","chart","chartRect","coords","options","$tooltip","$","container","length","appendTo","hide","tooltipHtml","values","html","reduce","prev","value","i","alphaNumerate","getTooltipOffset","left","top","height","outerHeight","show","index","css","Cursor","svg","elem","$header","showHeader","x","width","attr","style","x1","x2","y1","y2","IndexTracker","binarySearch","start","end","minDistanceIndex","undefined","middle","Math","floor","distance","abs","get","reset","set","newIndex","plugins","lineTooltip","extend","Line","series","labels","indexTracker","on","event","data","Array","type","target","tagName","toLowerCase","offsetX","originalEvent","layerX","map"],"mappings":"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","sourcesContent":["(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], function () {\n      return (root.returnExportsGlobal = factory());\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    root['Chartist.plugins.lineTooltip'] = factory();\n  }\n}(this, function () {\n\n  /**\r\n   * Chartist.js plugin to add tooltip in a line chart.\r\n   *\r\n   */\r\n  /* global Chartist */\r\n  (function (window, document, Chartist) {\r\n    'use strict';\r\n\r\n    var defaultOptions = {\r\n      formatHeader: Chartist.noop,\r\n      formatValue: Chartist.noop,\r\n      cursor: {\r\n        hiddenPosition: Chartist.noop,\r\n        header: Chartist.noop\r\n      },\r\n      classNames: {\r\n        tooltip: 'tooltip',\r\n        cursor: 'cursor'\r\n      }\r\n    };\r\n\r\n    var Tooltip = function (chart, chartRect, coords, options) {\r\n\r\n      var $tooltip = $('.' + options.classNames.tooltip, chart.container);\r\n\r\n      if (!$tooltip.length) {\r\n        $tooltip = $('<div class=\"' + options.classNames.tooltip + '\"></div>').appendTo(chart.container);\r\n      }\r\n\r\n      $tooltip.hide();\r\n\r\n      var tooltipHtml = function (header, values) {\r\n\r\n        var html = '<div class=\"header\">' + (header || '') + '</div>';\r\n\r\n        return values.reduce(function (prev, value, i) {\r\n          return prev + '<div class=\"series series-' + Chartist.alphaNumerate(i) + '\">' +\r\n            '<svg class=\"series-label\"><line x1=\"0\" x2=\"100%\" y1=\"50%\" y2=\"50%\" class=\"label-line\"></line></svg>' +\r\n            '<div class=\"value\">' + value + '</div></div>';\r\n        }, html);\r\n      };\r\n\r\n      var getTooltipOffset = function (left) {\r\n        return {\r\n          left: left,\r\n          top: chartRect.height() / 2 - $tooltip.outerHeight() / 2\r\n        };\r\n      };\r\n\r\n      this.hide = function () {\r\n        $tooltip.hide();\r\n      };\r\n\r\n      this.show = function (index, header, values) {\r\n        $tooltip\r\n        .html(tooltipHtml(header, values))\r\n        .css(getTooltipOffset(coords[index]))\r\n        .show();\r\n      };\r\n    };\r\n\r\n    var Cursor = function (chart, chartRect, coords, options) {\r\n\r\n      var cursor = chart.svg.elem('line', {}, options.classNames.cursor);\r\n\r\n      var $header = $('.' + options.classNames.cursor + '-header', chart.container);\r\n\r\n      if (!$header.length) {\r\n        $header = $('<span class=\"' + options.classNames.cursor + '-header\" style=\"position: absolute\"></span>')\r\n          .appendTo(chart.container);\r\n      }\r\n\r\n      $header.hide();\r\n\r\n      var showHeader = function (x) {\r\n        $header\r\n          .html(options.cursor.header() || '')\r\n          .css({ top: 0, left: x - $header.width() / 2 })\r\n          .show();\r\n      };\r\n\r\n      this.hide = function () {\r\n        cursor.attr({ style: 'display: none' });\r\n        $header.hide();\r\n      };\r\n\r\n      this.show = function (index) {\r\n\r\n        var x = coords[index];\r\n\r\n        showHeader(x);\r\n\r\n        cursor.attr({\r\n          x1: x,\r\n          x2: x,\r\n          y1: chartRect.y1,\r\n          y2: chartRect.y2 + $header.height(),\r\n          style: ''\r\n        });\r\n      };\r\n    };\r\n\r\n    var IndexTracker = function (coords) {\r\n\r\n      var index = -1;\r\n\r\n      var binarySearch = function (value, start, end, minDistanceIndex) {\r\n\r\n        if (start === undefined) {\r\n          start = 0;\r\n        }\r\n        if (end === undefined) {\r\n          end = coords.length - 1;\r\n        }\r\n\r\n        if (start > end) {\r\n          return minDistanceIndex;\r\n        }\r\n\r\n        var middle = Math.floor((start + end) / 2);\r\n        var distance = Math.abs(value - coords[middle]);\r\n\r\n        if (distance === 0) {\r\n          return middle;\r\n        }\r\n\r\n        if (minDistanceIndex === undefined || distance < Math.abs(value - coords[minDistanceIndex])) {\r\n          minDistanceIndex = middle;\r\n        }\r\n\r\n        if (value < coords[middle]) {\r\n          return binarySearch(value, start, middle - 1, minDistanceIndex);\r\n        } else {\r\n          return binarySearch(value, middle + 1, end, minDistanceIndex);\r\n        }\r\n      };\r\n\r\n      this.get = function () {\r\n        return index;\r\n      };\r\n\r\n      this.reset = function () {\r\n        index = -1;\r\n      };\r\n\r\n      this.set = function (x) {\r\n\r\n        var newIndex = binarySearch(x);\r\n\r\n        if (index === newIndex) {\r\n          return false;\r\n        }\r\n\r\n        index = newIndex;\r\n\r\n        return true;\r\n      };\r\n    };\r\n\r\n    Chartist.plugins = Chartist.plugins || {};\r\n    Chartist.plugins.lineTooltip = function (options) {\r\n\r\n      options = Chartist.extend({}, defaultOptions, options);\r\n\r\n      return function (chart) {\r\n\r\n        if (!(chart instanceof Chartist.Line)) {\r\n          return;\r\n        }\r\n\r\n        var series,\r\n           labels,\r\n           coords;\r\n\r\n        var tooltip,\r\n           cursor,\r\n           indexTracker;\r\n\r\n        chart.on('data', function (event) {\r\n          labels = event.data.labels;\r\n          coords = new Array(labels.length);\r\n          series = new Array(event.data.series.length);\r\n        });\r\n\r\n        chart.on('draw', function (data) {\r\n\r\n          if (data.type === 'line') {\r\n            series[data.index] = data.values;\r\n          }\r\n\r\n          if (data.type === 'point') {\r\n            coords[data.index] = data.x;\r\n          }\r\n        });\r\n\r\n        chart.on('created', function (data) {\r\n          indexTracker = new IndexTracker(coords);\r\n          tooltip = new Tooltip(chart, data.chartRect, coords, options);\r\n          cursor = new Cursor(chart, data.chartRect, coords, options);\r\n        });\r\n\r\n        $(chart.container).on('mouseleave', function () {\r\n          indexTracker.reset();\r\n          tooltip.hide();\r\n          cursor.hide();\r\n        });\r\n\r\n        $(chart.container).on('mousemove', '.' + chart.options.classNames.chart, function (event) {\r\n\r\n          if (event.target.tagName.toLowerCase() !== 'svg') {\r\n            return;\r\n          }\r\n\r\n          var offsetX = event.offsetX || event.originalEvent.layerX;\r\n\r\n          if (!indexTracker.set(offsetX)) {\r\n            return;\r\n          }\r\n\r\n          var index = indexTracker.get();\r\n\r\n          if (options.cursor.hiddenPosition() === labels[index]) {\r\n            cursor.hide();\r\n          } else {\r\n            cursor.show(index);\r\n          }\r\n\r\n          var values = series.map(function (x, i) {\r\n            return options.formatValue(x[index], i);\r\n          });\r\n\r\n          tooltip.show(index, options.formatHeader(labels[index], index), values);\r\n        });\r\n      };\r\n    };\r\n\r\n  }(window, document, Chartist));\r\n\n  return Chartist.plugins.lineTooltip;\n\n}));\n"]}